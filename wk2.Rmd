
---
title: "COVID-19 Data Visualization"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---


```{r}
# Clearing the environment
rm(list = ls())

# Loading required libraries
library(ggplot2)
library(dplyr)
library(ggrepel)

# Reading the COVID-19 data from Massachusetts
link <- "https://github.com/DACSS-Visual/tabular_bivar_numnum/raw/main/data/covidMA.rds"
covidMA <- readRDS(url(link))

# Data aggregation by county
covidMA_county <- aggregate(data = covidMA, cbind(deaths, cases) ~ County, mean)

# Removing counties with zero deaths or cases
covidMA_county <- covidMA_county %>%
  filter(deaths > 0 & cases > 0)

# Calculating the Pearson correlation for context
correlation_test <- cor.test(covidMA_county$deaths, covidMA_county$cases, method = "pearson")
print(correlation_test)

# Title, subtitle, and caption for the plot
titleText <- "Correlation between COVID-19 Cases and Deaths by County"
sub_titleText <- "Pearson correlation for Massachusetts counties"
captionText <- "Source: MA - Covid19 Dashboard | Website: https://www.mass.gov/info-details/covid-19-reporting"

# Creating the scatter plot with regression line and annotations
scatPlot <- ggplot(covidMA_county, aes(x = deaths, y = cases)) +
  geom_point(size = 3, alpha = 0.7, color = "blue") + # Blue points for cases
  geom_smooth(method = "lm", color = "red", se = FALSE) + # Red regression line
  geom_text_repel(aes(label = County), size = 3) +  # Annotating county names
  labs(
    title = titleText, 
    subtitle = sub_titleText, 
    caption = captionText, 
    x = "Average Deaths", 
    y = "Average Cases"
  ) +
  theme_minimal() +  # Clean theme with minimal gridlines
  theme(
    plot.caption = element_text(hjust = 0), 
    axis.text = element_text(size = 12)
  )

# Display the plot
print(scatPlot)
# Saving the scatter plot object correctly
saveRDS(scatPlot, file = "scatplot2.rds")

```

