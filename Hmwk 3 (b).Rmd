---
title: "Boston Campaign Contributions Dashboard"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
runtime: shiny
---

Column {data-width=500}

### Check Contributions
```{r, echo=FALSE}
leaflet_check

leaflet_credit




install.packages("sf")

install.packages("dplyr")

install.packages("leaflet")
install.packages("leafsync")



```


```{r}
library(sf)
library(dplyr)
library(leaflet)
library(leafsync)
library(ggplot2)
library(rio)
library(patchwork)
```

```{r}



# Step 1: Reload contribution data
linkBoston <- "https://github.com/DACSS-Visual/SpatialData/raw/refs/heads/main/data/BostonContrib.xlsx"
bostonCont <- rio::import(linkBoston)

# Step 2: Aggregate contributions
selected_data <- bostonCont %>%
  group_by(Zip, `Tender Type Description`) %>%
  summarise(
    mean_contribution = mean(Amount, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  filter(`Tender Type Description` %in% c("Check", "Credit Card")) %>%
  mutate(Zip = as.character(Zip))

# Step 3: Reload ZIP code map
linkZips <- "https://raw.githubusercontent.com/DACSS-Visual/SpatialData/refs/heads/main/data/zip_codes.json"
bostonZips <- sf::read_sf(linkZips)

# Step 4: Prepare ZIP code column
bostonZips$ZIP5 <- as.character(bostonZips$ZIP5)

# Step 5: Merge map data with contribution data
merged_map <- bostonZips %>%
  left_join(selected_data, by = c("ZIP5" = "Zip"))

# Step 6: Filter for each tender type
check_map <- merged_map %>% filter(`Tender Type Description` == "Check")
credit_card_map <- merged_map %>% filter(`Tender Type Description` == "Credit Card")

# Step 7: Create Static Map for 'Check'
# Map for 'Check'
ggplot_check <- ggplot(data = check_map) +
  geom_sf(aes(fill = mean_contribution), color = "white", size = 0.2) +
  scale_fill_distiller(palette = "YlOrRd", direction = 1, na.value = "grey80") +
  labs(
    title = "Mean Contribution by Check Across Boston ZIP Codes",
    subtitle = "Aggregated contributions by 'Check'",
    fill = "Mean Contribution (USD)",
    caption = NULL
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    plot.subtitle = element_text(size = 12),
    plot.caption = element_text(size = 10, face = "italic")
  )

# Map for 'Credit Card'
ggplot_credit_card <- ggplot(data = credit_card_map) +
  geom_sf(aes(fill = mean_contribution), color = "white", size = 0.2) +
  scale_fill_distiller(palette = "YlOrRd", direction = 1, na.value = "grey80") +
  labs(
    title = "Mean Contribution by Credit Card Across Boston ZIP Codes",
    subtitle = "Aggregated contributions by 'Credit Card'",
    fill = "Mean Contribution (USD)",
    caption = NULL
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    plot.subtitle = element_text(size = 12),
    plot.caption = element_text(size = 10, face = "italic")
  )

# Combine the maps side by side
combined_maps <- ggplot_check + ggplot_credit_card +
  plot_layout(ncol = 2) +
  plot_annotation(
    title = "Comparison of Mean Contributions by Tender Type",
    caption = "Data Source: Boston Campaign Contributions Dataset"
  )

# Save the combined map
ggsave("combined_tender_type_maps_dashboard.png", combined_maps, width = 14, height = 8)

# Display the combined map
combined_maps



saveRDS(combined_maps, file = "combined_tender_type_maps.rds")









```



